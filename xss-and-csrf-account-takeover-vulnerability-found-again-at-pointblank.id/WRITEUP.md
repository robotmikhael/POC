# Penemuan BUG Part 2 : *Reflected XSS* and *CSRF Account Takeover* Again at Official Website PB Zepetto Indonesia
### Author : Mikhro <br><a href="https://www.facebook.com/josh.s.mikhael" rel="nofollow"><img src="https://img.shields.io/badge/contact-facebook-blue.svg" alt="Twitter" data-canonical-src="https://img.shields.io/badge/facebook-josh.s.mikhael-blue.svg" style="max-width:100%;"></a> <br> **Date** : <kbd> Senin, 15 April 2019</kbd>

> Tags : [#bugbounty](https://www.google.com/search?q=bugbounty) [#xss](https://www.google.com/search?q=xss) [#csrf](https://www.google.com/search?q=csrf) [#exploit](https://www.google.com/search?q=exploit) [#bughunter](https://www.google.com/search?q=bughunter) [#reflected_xss](https://www.google.com/search?q=reflected%20xss)

## ðŸ”¥ Proff Of Concept XSS ðŸ”¥
Setelah beberapa hari yang lalu saya menemukan dan melaporkan bug ***[open redirect lead to xss](https://github.com/robotmikhael/POC/blob/master/open-redirect-lead-to-xss-injection-at-pointblank.id/WRITEUP.md)*** pada website PB Zepetto lalu mendapat hadiah *2M* ðŸ˜Œ . **Jumat, 12 April 2019**, kali ini saya kembali iseng mencari bug pada website tersebut . <br> â€¢ Saya membuka setiap halaman pada website lalu menemukan halaman *[faq](https://www.pointblank.id/faq/list)* : <br>
![ss_halaman_faq](https://robotmikhael.github.io/img/IMG_20190415_102635.jpg) <br><br>
Dapat dilihat disitu ada *form pencarian* . Saya berpikir biasanya di form seperti ini rawan akan *celah/penyerangan* berjenis **[code injection](https://www.google.com/search?q=code%20injection)** semisal [XSS](https://www.google.com/search?q=xss), [SQLI](https://www.google.com/search?q=sqli) bahkan [RCE](https://www.google.com/search?q=rce). <br> â€¢ Untuk membuktikannya saya pun langsung mencoba untuk meng-input *test* pada form tersebut dan setelah saya enter, saya menemukan parameter yang cukup unik pada address bar ``` https://www.pointblank.id/faq/list?keyword=test ``` <br>
![ss_parameter](https://robotmikhael.github.io/img/IMG_20190415_105035.jpg) <br><br>
â€¢ Setelah itu saya coba *view-source* halaman tersebut , dan ini yang saya temukan : <br>
![ss_view-source_test_search](https://robotmikhael.github.io/img/IMG_20190415_105715.jpg) <br><br> 
Saya menyimpulkan bahwa kata *test* pada parameter ```?keyword= ``` ternyata ter-refleksi kedalam [attribute html](https://www.google.com/search?q=attribute%20html) yaitu pada bagian *value* ```value=test ```. Lalu saya coba masukkan ``` test"> ``` . <br>â€¢ Dan saya coba *view-source* kembali.<br>
![ss_view-source-2](https://robotmikhael.github.io/img/IMG_20190415_151229.jpg) <br><br>
Dari gambar di atas dapat kita lihat bahwa tidak adanya *filtering* pada karakter-kadakter seperti *double quote* ``` " ``` & karakter *greater-than* ``` > ```. <br>"Kalau begitu bagaimana jika saya melakukan manipulasi pada [attribute html](https://www.google.com/search?q=attribute%20html) dan [tag html](https://www.google.com/search?q=tag%20html) untuk memunculkan *pop up javacript* (XSS) ðŸ¤” ", pikir saya.<br>â€¢ Maka dari itu langsung saja saya coba masukkan payload ``` test"><body onload="javascript:prompt('xss3D By Mikhro')"><input value=" ``` setelah itu saya *view-source* : <br>
![ss_view-source-3](https://robotmikhael.github.io/img/IMG_20190415_160518.jpg) <br><br>
Dari gambar di atas dapat kita lihat bahwa saya berhasil melakukan manipulasi pada html tersebut. Berikut penjelasannya payloadnya : <br>
â€¢ **test">** : karakter ``` "> ``` digunakan untuk melepaskan diri dari attribute *value* yang berisi inputan user dan tag *input* . <br>
â€¢ ``` <body onload="javascript:prompt('xss3D By Mikhro')"> ``` : adalah script yang digunakan untuk memunculkan *pop up javascript* (XSS) . <br>
â€¢ ``` <input value=" ```  : digunakan untuk membuat **tag** dan **attribute** baru pada html agar tidak terjadi error . <br><br>

â€¢ Lalu saya coba untuk meng-eksekusi payload tersebut di browser , namun ternyata kena block sama [XSS Auditor](https://www.google.com/search?q=xss%20auditor) <br>
![ss_eksekusi_payload-xss-blocked](https://robotmikhael.github.io/img/IMG_20190415_172128.jpg) <br><br>
Saya udah coba semua browser Android dan ternyata masih kena block sama XSS Auditor . Akhirnya saya meminta tolong pada teman yang memiliki PC untuk membantu saya mengecek apakah payload saya ter-eksekusi dengan baik dan memunculkan pop up javascript . Saya menyuruhnya untuk meng-eksekusi lewat browser [Mozilla](https://www.google.com/search?q=Mozilla)  , kalau berhasil saya memintanya untuk meng-screenshot/meng-foto itu. Ternyata berhasil .<br>â€¢ Berikut fotonya : <br>
![ss_popup-success-executed](https://robotmikhael.github.io/img/1555332870576.jpg) <br><br>
"Yesss ! ðŸ˜€", kata saya dengan senang . <br>
![yeesss-gif](https://media.giphy.com/media/l0Iy7zmLUiALbkna8/giphy.gif) <br><br><br>
## ðŸ”¥ Proof Of Concept CSRF Account Takeover ðŸ”¥
Setelah menemukan bug ini , saya pun tidur . Saat itu kira-kira sudah jam 23.33 WIB . Pada **Sabtu, 13 April 2019** , sekitar Jam 03.30 WIB subuh<br>
saya terbangun => mengambil smartphone android saya lalu membuka fb. Di fb saya dapat notif kalau ada yang mengirim di [Grup Indoxploit](https://www.facebook.com/groups/416478038539895) ketika saya cek. Ternyata ada sebuah ***[write up tentang Bug CSRF pada web Elevenia](https://medium.com/@belvasaufa70/csrf-account-takeover-vulnerability-on-elevenia-co-id-poc-53684864cf4a)*** dari mhank ***[True Melody](https://www.facebook.com/profile.php?id=100005121827520)*** . Setelah membaca write up tersebut saya menjadi penasaran, "apakah bug CSRF pada web [Elevenia](http://www.elevenia.co.id) ini ada juga pada web PB Zepetto. Akhirnya daripada penasaran langsung saja saya coba. Berikut langkah-langkahnya :
1. **Menyiapkan setidaknya 2 akun , 1 akun *Attacker* & 1 lagi akun *User/Victim*** : <br>
Jadi di sini saya telah menyiapkan 2 akun dengan username "hacker" sebagai **Attacker/Hacker** dan username "iamvictim" sebagai **Victim/Korban** .<br>Kedua akun ini memiliki password yang sama yaitu ***pass1234*** .<br>
2. **Mengganti password pada akun *Attacker*** : <br>
Disini saya menyalakan [Net Capture](https://www.google.com/url?sa=t&source=web&rct=j&url=https://play.google.com/store/apps/details%3Fid%3Dcom.minhui.networkcapture%26hl%3Den%26referrer%3Dutm_source%253Dgoogle%2526utm_medium%253Dorganic%2526utm_term%253Dssl%2Bpacket%2Bcapture%26pcampaignid%3DAPPU_1_-au0XKqDO4vnvgTNkpGQAg&ved=2ahUKEwjq45upvdLhAhWLs48KHU1JBCIQ8oQBMAB6BAgKEAM&usg=AOvVaw2E0AaGvzARY9G_42PN7Fa1) lalu mengganti password akun **Attacker** dari ***pass1234*** menjadi ***passbaru123*** . Lalu **Attacker** akan logout dari akunnya untuk menghilangkan/melenyapkan sessionnya , supaya tidak tabrakan, begitu kira-kira kalau diumpamakan .<br>â€¢ Berikut hasil sniff/post datanya : <br>
![ss_sniff-change-pass](https://robotmikhael.github.io/img/IMG_20190416_011855.jpg)<br><br>
3. **Membuat script/payload untuk menjalankan skema CSRF nya :** <br>
â€¢ Dari hasil sniff pada gambar di atas , saya membuat payload html sederhana : <br>
```
<html>
<body>
    <form action="https://www.pointblank.id/password/change/process" method="POST">
          <input type="text" name="SESSION" value="SESSIONNYA">

          <input type="text" name="oldpassword" value="pass1234">
          <input type="text" name="password" value="passbaru123">
          <input type="text" name="repassword" value="passbaru123">
          	
          <input type="submit" value="Send Hadiah">
    </form>
</body>
</html>
```

Nantinya script ini akan dijadikan media/akses/celah oleh Attacker untuk **mengambil alih akun dengan menggati password *User/Victim* secara diam-diam** .

4. **Mengirimkan link yang telah di shortener berisi file script di atas pada victim melalui email dengan iming-iming hadiah** .<br>User/Victim awam yang keadaannya sedang ter-login pada website **poitblank.id** ketika mendapat email dari **Attacker** pasti akan mudah percaya dan segera membuka link tersebut lalu menekan tombol "*Send Hadiah*" untuk menerima hadiah .<br>â€¢ Berikut ini gambar gif disisi *Victim* yang akan menggambarkan penjelasan saya : <br>
![gif_user-klik-link-untuk-change-password](https://robotmikhael.github.io/img/Screenrecorder201904160025.gif) <br>
> Note : disitu ceritanya *Victim* sedang dalam keadaan login pada website **pointblank.id** dan ketika ia mengklik link tersebut lalu kembali ke halaman user/dashboard , ia tidak ter-logout<br><br>




